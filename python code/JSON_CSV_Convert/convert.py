import sys
import json
home_directory = "/Users/MaxBox1/GitHub/MalwareTensorResearch/python code/JSON_CSV_Convert/"

class Malware:
    def __init__(self):
        self.DllCharacteristics = []
        self.FILE_HEADER = []
        self.Parsing_Warnings = []
        self.Directories = []
        self.DOS_HEADER = []
        self.OPTIONAL_HEADER = []
        self.NT_HEADERS = []
        self.Flags = []
        self.PE_Sections = []

def get_file_names():
    file_names = sys.argv[1:]
    return file_names

def iterate_key(json_file, goal_key):
    values = [goal_key]
    if not isinstance(json_file[goal_key], dict):
        return json_file[goal_key]
    for key in json_file[goal_key]:
        values.append(iterate_key(json_file[goal_key], key))
    #print(values)
    return values


def convert_to_csv(file):
    my_mal = Malware()
    json_file = open(home_directory + file).read()
    json_file = json.loads(json_file)
    my_mal.DllCharacteristics = json_file['DllCharacteristics']
    my_mal.Parsing_Warnings = json_file["Parsing Warnings"]
    my_mal.Flags = json_file["Flags"]
    my_mal.FILE_HEADER = iterate_key(json_file, "FILE_HEADER")
    print(my_mal.FILE_HEADER)
    print(my_mal.DllCharacteristics)


def convert_to_json(file):
    return


def main():
    files = get_file_names()
    for file in files:
        if file.endswith('.json'):
            convert_to_csv(file)
        elif file.endswith('.csv'):
            convert_to_json(file)
        else:
            print("Unrecgonized file extension: ", file)
main()
